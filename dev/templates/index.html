<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>GUI</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
        integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <h1 class="title">Lab 3 - Grupo 1 :)</h1>
    <div class="_d-flex _flex-column">
        <div class="control-element">
            Test:
            <span class="badge badge-light" id="testValue"></span>
            <button type="button" class="btn btn-primary" onclick="incrementTest()">+</button>
            <button type="button" class="btn btn-warning" onclick="incrementTest()">-</button>
            Valor desejado: <input class="input-control" id="testInput" value="" onfocusout="updateTest()"
                onkeydown="updateTestEnter()"></input>
        </div>
        <div class="control-element">
            Test2:
            <span class="badge badge-light" id="testValue2"></span>
            <button type="button" class="btn btn-primary" onclick="incrementTest2()">+</button>
            <button type="button" class="btn btn-warning" onclick="incrementTest2()">-</button>
            Valor desejado: <input class="input-control" id="test2Input" value="" disabled></input>
        </div>
    </div>
    <div class="start-stop-buttons">
        <button type="button" class="btn btn-success" onclick="startStatsRefresh()">Start</button>
        <button type="button" class="btn btn-danger" onclick="stopStatsRefresh()">Stop</button>
    </div>

    <script>
        let telemetryStatsRefreshMethod
        const updateTelemetry = () => {
            const testValue = document.getElementById('testValue')
            const testValue2 = document.getElementById('testValue2')

            fetch("/simulation_data", {
                method: "GET"
            }).then(response => response.json()).then(telemetryStats => {
                console.log(telemetryStats)
                testValue.textContent = telemetryStats.test
                testValue2.textContent = telemetryStats.test2
            })

            telemetryStatsRefreshMethod = window.setTimeout(updateTelemetry, 500)
        }

        const startStatsRefresh = () => telemetryStatsRefreshMethod = window.setTimeout(updateTelemetry, 500)
        const stopStatsRefresh = () => clearTimeout(telemetryStatsRefreshMethod)

        startStatsRefresh()

        const incrementTest = () => {
            fetch("/increment_test", {
                method: "POST",
                body: {
                    // some: data
                }
            });
        }

        const incrementTest2 = () => {
            fetch("/increment_test2", {
                method: "POST",
                body: {
                    // some: data
                }
            });
        }

        const updateTest = () => {
            const input = document.getElementById('testInput');
            fetch(`/update_test/${input.value}`, {
                method: "POST",
                body: {}
            }).then(() => {
                input.value = ''
            });
        }

        const updateTestEnter = () => {
            if (event.key === 'Enter') {
                updateTest()
            }
        }
    </script>
</body>

</html>